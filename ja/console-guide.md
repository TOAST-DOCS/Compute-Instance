## Compute > Instance > コンソール使用ガイド

## インスタンス生成

### イメージ

希望のオペレーションシステムがインストールされているイメージを選択します。イメージはTOASTが提供するパブリックイメージ、作成済のユーザーイメージ、共有イメージから選択できます。

使用するイメージによってインスタンス仕様(flavor)が異なるので、インスタンス生成の際は、まず初めにイメージを選択してください。

| オペレーションシステム                  | ディスク    | メモリ  |
| ---------------------------------------- | ---------- | -------- |
| Linux<br>CentOS、Ubuntu、Debian | 20GB以上  | 1GB以上 |
| Windows                           | 50GB以上  | 2GB以上 |


### アベイラビリティーゾーン(availability zone)

アベイラビリティーゾーンを明示的に設定しない場合、任意の領域に設定されます。アベイラビリティーゾーンに応じて、このインスタンスが使用できるブロックストレージが決定されます。使用するブロックストレージが特定アベイラビリティーゾーンに存在する場合は、そのアベイラビリティーゾーンに設定して使用します。

> [参考] VPCのリソースは全てのアベイラビリティーゾーンで使用できます。

アベイラビリティーゾーンの詳細については[インスタンス概要のアベイラビリティーゾーン](/Compute/Instance/ja/overview/#_4)を参照してください。

### 仕様(flavor)

仮想ハードウェアの性能に応じて様々な仕様を選択できます。ただし、イメージが要求する仮想ハードウェアの性能に応じて、選択できる仕様が制限されることがあります。詳細については[インスタンス概要](./overview)を参照してください。

インスタンスの仕様は生成後にもTOASTコンソールで変更できます。高い仕様から低い仕様に、また低い仕様から高い仕様に変更することもできます。一部仕様は変更できない場合もあるので詳細は[インスタンス仕様変更](./console-guide/#_14)を参照してください。

> [注意]インスタンスの基本ディスクは仕様変更で変えることができません。

### ディスクサイズ

インスタンスの基本ディスクサイズを決定します。

- インスタンスが一度生成されると、基本ディスクサイズは変更できません。インスタンスのディスク容量が足りない場合は、ブロックストレージを追加して使用する必要があります。
- ディスクのサイズはイメージが要求する最小サイズ以上にする必要があります。

インスタンスの基本ディスクサイズはインスタンス仕様によって異なります。

| 仕様           | サポートするディスクのサイズ        |
| ----------------　| -------------------------------- |
| Uタイプ         | 20 ～ 100 GB (仕様ごとに固定) |
| T、M、C、R、Xタイプ | 20～1000GB       　        |

>[参考]ディスクのサイズに応じて課金されるため、基本ディスクサイズを無条件に大きくするのは非効率的です。必要に応じてブロックストレージを追加して使用すると良いでしょう。

### ボリュームタイプ

インスタンスの基本ディスクタイプを決定します。

- **HDD**または**SSD**のいずれかを選択します。タイプによって料金と性能が異なります。
- 一度選択したディスクタイプは変更できません。 

### インスタンス数

イメージ、アベイラビリティーゾーン、仕様、ディスクサイズ、キーペア、ネットワーク設定が、全て同じインスタンスを複数生成する場合に使用します。インスタンスの名前には、設定した名前の後ろに「-1」、「-2」のような番号が振られます。例えば、インスタンス名を「my-instance」にしてインスタンスを2個生成すると、「my-instance-1」、「my-instance-2」が生成されます。一度に生成できる最大インスタンス数は10個です。

任意のアベイラビリティーゾーンにインスタンスを複数生成した場合、それぞれのインスタンスは任意のアベイラビリティーゾーンに生成されます。例えば、2個のインスタンスを任意のアベイラビリティーゾーンに生成した場合、2個が同じアベイラビリティーゾーンに生成されることもあれば、別のアベイラビリティーゾーンに生成されることもあります。全てのインスタンスを同じアベイラビリティーゾーンに生成する必要がある時は、特定アベイラビリティーゾーンを選択して生成します。

### キーペア

既存のキーペアを使用したり、新たにキーペアを生成して使用します。既存キーペアの登録はWindowsユーザーの場合、[キーペア作成(Windowsユーザー)](./console-guide/#_16)、Mac、Linuxユーザーの場合は[キーペア作成(Mac、Linuxユーザー)](./console-guide/#_17)を参照してください。

### セキュリティーグループ

インスタンスが属すセキュリティーグループを指定します。一つのインスタンスは複数のセキュリティーグループに属すことがあります。インスタンスが複数のセキュリティーグループに属す場合は、次を参照してください。

- 各セキュリティーグループに属している全てのインスタンスとネットワーク通信ができます。別のインスタンスの意図していないアクセスを防ぐ必要のある機密データを持つインスタンスの場合は、慎重にセキュリティーグループを指定する必要があります。
- 各セキュリティーグループの全てのルールが合わさって、該当のインスタンスの外部通信に適用されます。

セキュリティーグループの詳細については[VPC概要](/Network/VPC/ja/overview/)を参照してください。

### ネットワーク

VPCで定義されたサブネットの中からインスタンスに接続するサブネットを選択します。サブネットを一つ選択するたびに、インスタンスに該当のサブネットに接続するネットワークインターフェイスが作られます。選択されたサブネットの順序を変えてネットワークインターフェイスを変更することもできます。この場合、最初のネットワークインターフェイス(`eth0`)が基本ゲートウェイに設定されます。

ネットワーク作成と管理の詳細については[VPC概要](/Network/VPC/ja/overview/)を参照してください。

## インスタンス追加機能

### イメージ作成

インスタンスの基本ディスクからイメージを作成します。イメージ作成はデータの整合性を保障するために、インスタンスを終了した状態でのみ進行できます。イメージ作成コマンドが無効になっている場合は、先にインスタンスを終了する必要があります。

インスタンスの基本ディスクの空き容量が全くない状態でイメージ作成はできますが、イメージを別のインスタンスで使用するための初期化作業は行えないので、正常に使用できません。イメージを作成する前にインスタンスで最低100KBの空き容量を確保します。

作成されたイメージは**Compute > Image**にPrivateイメージとして登録されます。登録されたイメージを利用して、元のインスタンスと同じディスクを持つインスタンスを作成できます。

### Floating IP接続と解除

インスタンスの状態にかかわらずFloating IPを接続または解除できます。使用できるFloating IPがない場合や、希望するFloating IPがない場合、**生成**ボタンをクリックしてFloating IPを生成して接続できます。また**Network > VPC > Floating IP**でFloating IPを生成して使用することもできます。

Floating IPの詳細については[VPC概要](/Network/VPC/ja/overview/)を参照してください。

### セキュリティーグループ修正

インスタンスの状態に関わらずインスタンスのセキュリティーグループを修正できます。修正されたセキュリティーグループはすぐに適用されます。

セキュリティーグループの詳細については[セキュリティーグループ](./console-guide/#_8)と[VPC概要](/Network/VPC/ja/overview/)を参照してください。

### ネットワークインターフェイス修正

インスタンスの状態に関わらず、インスタンスのネットワークインターフェイスを追加または削除できます。ネットワークインターフェイスを削除する時、インターフェイスにFloating IPが接続されている場合は、Floating IPも一緒に接続が解除されます。一度接続が解除されたFloating IPは同じネットワークインターフェイスを再度追加しても自動的に接続されません。ネットワークインターフェイス追加後に再度、希望するFloating IPを接続する必要があります。

### インスタンス仕様変更

インスタンスの仕様は、インスタンスを終了した後に変更できます。インスタンスが実行中の場合は**追加機能**の**インスタンス終了**をクリックしてインスタンスを終了します。

現在の仕様に応じて、変更できるインスタンスの仕様が異なります。

* M、C、R、T、XタイプのインスタンスはM、C、R、T、Xタイプのインスタンス仕様に変更できます。
* M、C、R、T、XタイプのインスタンスはUタイプのインスタンス仕様に変更できません。
* Uタイプは生成後に仕様を変更できません。同じUタイプのインスタンス仕様へも変更できません。

インスタンスの仕様を変更すると、変更作業と変更確認作業が行われます。全ての作業が完了するとVM状態が**Shutoff**状態になり、**追加機能**の**Start instance**をクリックしてインスタンスを起動できます。

> [参考]インスタンスの基本ディスクサイズは変更できません。インスタンスのディスク容量が足りない場合は、ブロックストレージを追加して使用します。ブロックストレージ追加方法については[ブロックストレージ概要](/Storage/Block%20Storage/ja/overview/)を参照してください。

インスタンスは変更時点を基準に変更された仕様で課金されます。

## キーペア

### キーペアを作成する(Windowsユーザー)

PuTTY SSHクライアントをインストールすると一緒にインストールされるputtygenプログラムでキーペアを生成し、TOASTに登録して使用できます。

[PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)をインストールします。

Puttygenを実行します。

![イメージ1](http://static.toastoven.net/prod_instance/putty-ssh-001-en.png)

**パラメータ**で**RSA**(旧バージョンのputtygenではSSH-2 RSA)を選択します。 **Actions**にある**「Generate」**ボタンをクリックします。キーを生成するために空欄の中でマウスを動かします。

キーが生成されたら下図のように公開鍵ファイル内容が表示されます。公開鍵全体を**キーペア作成**の**公開鍵:**入力欄に貼り付けてキーペアを登録します。

![イメージ1](http://static.toastoven.net/prod_instance/putty-ssh-002-en.png)

** Actions **の**「Save private key」**をクリックして秘密鍵を保存します。キーパスフレーズを空欄のまま秘密鍵を保存すると、**キーパスフレーズで保護されないままこのキーを保存しますか？**というメッセージが表示されます。変換された秘密鍵をより安全に使用するには、キーパスフレーズを設定して保存します。

> [注意]
インスタンスに自動的にログインするには、キーパスフレーズを使わないでください。キーパスフレーズを使用するとログインする際に秘密鍵のパスワードを直接入力する必要があります。

登録したキーペアはインスタンスを生成する時に使用でき、インスタンス接続時にはこのキーペアの秘密鍵で接続する必要があります。インスタンス接続方法は[インスタンス概要](./overview/#_9)を参照してください。

TOASTで生成したキーペア同様、このように作成されたキーペアの秘密鍵も外部に流出すると、誰でも流出した秘密鍵でそのインスタンスにアクセスできるようになるので、慎重に管理する必要があります。



### キーペア作成(Mac、Linuxユーザー)

MacやLinuxの「ssh-kegen」で作成したキーペアをTOASTに登録して使用できます。キーペアは次のコマンドで作成します。

	$ ssh-keygen -t rsa -f my_key.key

キーペアのパスワードは設定しても構いませんが、設定しなくても問題はありません。セキュリティーレベルを上げるならば、パスワードの設定を推奨します。入力したキーペアの名前に拡張子「.pub」が追加されたファイル内にキーペア公開鍵が入っています。

	$ cat my_key.key.pub
	ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCnnUAe36txQqk8J7VzbNuYKVQQ3gbNoClndHMX49OD+1Rw5xrDFLUKQqxbBDtlNMoA9tKBZNrQBpKr1kFEtvMIj1HPkH9ocb4MbuoVVjpkIhixbKMMJPDQ4JQJxaifsjR59YsZyDAp0aXZp+o+OB97P3S4AKPY2kQR0JdSr30+6Av6smf+3mZceAE4abzklfbyWT5slP1im/wfYEPO3QBEDl/0JbmTjKWPYI6QnbwnPRHS63SJ+Kd2QeYQYJCadv7X4mXnw81qEIWq/dx1SQkGDTNgR7lnN2ApFlU5EZcow69z6tiCr0hlyigwjGooMg3wTZvcSlYcVeTzZ755RArd ...

この内容全体を**キーペア作成**の**公開鍵:**入力欄に貼り付けてキーペアを登録します。

登録したキーペアはインスタンスを生成する時に使用でき、インスタンス接続時にはこのキーペアの秘密鍵で接続する必要があります。インスタンス接続方法は[インスタンス接続方法](./overview/#_9)を参照してください。

TOASTで生成したキーペア同様、このように作成されたキーペアの秘密鍵も外部に流出すると誰でも流出した秘密鍵でそのインスタンスにアクセスできるようになるので慎重に管理する必要があります。

